<head><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=stylesheet href=https://jemmycat.github.io/css/style.css><link rel=stylesheet href=https://jemmycat.github.io/css/post-list.css><link rel=stylesheet href=https://jemmycat.github.io/css/single.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css><title>为网站配置免费的域名证书 - 陈迪的博客</title></head></head><div class=container><header><div class=profile-header><img src=https://jemmycat.github.io/images/avatar.png alt="User Avatar" class=profile-avatar><div class=profile-info><h1 class=profile-name>Jemmy</h1><p class=profile-status>豆豆柴 水晶塔</p><p class=profile-level>LV1 进阶冒险者 | UID: 10358885</p><p class=profile-description>35岁玩家，喜欢海岛冒险的相机和咖啡爱好者。忙碌于拯救攻城怪物，还没来得及好好介绍自己。</p></div></div></header><main><div class=main-wrapper><div class=sidebar><button class=sidebar-btn>
<a href=/about>我的简介</a>
</button>
<button class=sidebar-btn>
<a href=/>我的主页</a></button></div><div class=posts-content><div class=posts><header><h1 class=post-title>为网站配置免费的域名证书</h1><p class=post-meta>October 22, 2024 · By</p></header><article><article class=post><section class=post-body><aside class=toc><h2>目录</h2><nav id=TableOfContents><ul><li><ul><li><a href=#安装-acmesh>安装 acme.sh</a></li><li><a href=#打开-godaddy>打开 Godaddy</a></li><li><a href=#创建新的-api-key>创建新的 API Key</a></li><li><a href=#保存生成的-key-和-secret>保存生成的 Key 和 Secret</a></li><li><a href=#配置环境变量并生成证书>配置环境变量并生成证书</a></li><li><a href=#安装nginx>安装nginx</a></li><li><a href=#将证书导出到-nginx-目录证书会被定期renew>将证书导出到 nginx 目录（证书会被定期renew）</a></li><li><a href=#配置nginx>配置nginx</a></li><li><a href=#重载-nginx>重载 Nginx</a></li></ul></li></ul></nav></aside><p><p><img src=https://image.written.cc/i/2024/10/22/67171230ea128.png alt=1729565225093.png></p><p><a href=https://acme.sh>acme.sh</a> 实现了ACME 协议，它不仅可以为您的域名从 Let&rsquo;s Encrypt 生成免费的证书，而且通过配套的自动更新功能，能够为证书自动续期。</p><blockquote><p>基于 CentOS 7</p></blockquote><h3 id=安装-acmesh>安装 acme.sh</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl  &lt;https://get.acme.sh&gt; | sh
</span></span></code></pre></div><h3 id=打开-godaddy>打开 Godaddy</h3><ul><li>打开Godaddy开发者平台</li><li>打开API Keys</li><li>Create New API Key（创建新的API Key）</li></ul><h3 id=创建新的-api-key>创建新的 API Key</h3><ul><li>填写API Key的名称（可选）</li><li>环境（Environment）选择产品（Production）</li></ul><h3 id=保存生成的-key-和-secret>保存生成的 Key 和 Secret</h3><h3 id=配置环境变量并生成证书>配置环境变量并生成证书</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export GD_Key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gHzatxxxf8geRg7UGanJiaKyied2F&#34;</span>
</span></span><span style=display:flex><span>export GD_Secret<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;RMuBD3tRixxxYDkGewPGY&#34;</span>
</span></span><span style=display:flex><span>acme.sh --issue --dns dns_gd -d  thongpunchangrc.com -d <span style=color:#e6db74>&#39;*.thongpunchangrc.com&#39;</span>
</span></span></code></pre></div><h3 id=安装nginx>安装nginx</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install nginx
</span></span></code></pre></div><h3 id=将证书导出到-nginx-目录证书会被定期renew>将证书导出到 nginx 目录（证书会被定期renew）</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir /etc/nginx/cert
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>acme.sh --install-cert  -d picokkplus.com -d *.picokkplus.com --key-file /etc/nginx/cert/key.pem --fullchain-file /etc/nginx/cert/cert.pem
</span></span></code></pre></div><h3 id=配置nginx>配置nginx</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim /etc/nginx/conf.d/picokkplus.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    listen 80;
</span></span><span style=display:flex><span>    server_name www.picokkplus.com picokkplus.com;
</span></span><span style=display:flex><span>    rewrite ^/<span style=color:#f92672>(</span>.*<span style=color:#f92672>)</span> &lt;http://www.picokkplus.com/$1&gt; permanent;
</span></span><span style=display:flex><span>    root /data/html/picokkplus;
</span></span><span style=display:flex><span>    index index.html index.php;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    listen <span style=color:#ae81ff>443</span> ssl;
</span></span><span style=display:flex><span>    server_name www.picokkplus.com picokkplus.com;
</span></span><span style=display:flex><span>    ssl_certificate /etc/nginx/cert/cert.pem;
</span></span><span style=display:flex><span>    <span style=color:#75715e>#填写证书私钥文件绝对路径</span>
</span></span><span style=display:flex><span>    ssl_certificate_key /etc/nginx/cert/key.pem;
</span></span><span style=display:flex><span>    ssl_session_cache shared:SSL:1m;
</span></span><span style=display:flex><span>    ssl_session_timeout 5m;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#自定义设置使用的TLS协议的类型以及加密套件（以下为配置示例，请您自行评估是否需要配置）</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># TLS协议版本越高，HTTPS通信的安全性越高，但是相较于低版本TLS协议，高版本TLS协议对浏览器的兼容性较差。</span>
</span></span><span style=display:flex><span>    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
</span></span><span style=display:flex><span>    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#表示优先使用服务端加密套件。默认开启</span>
</span></span><span style=display:flex><span>    ssl_prefer_server_ciphers on;
</span></span><span style=display:flex><span>    <span style=color:#75715e>#将所有HTTP请求通过rewrite指令重定向到HTTPS。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    client_max_body_size 500m;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        root  /data/html/picokkplus;
</span></span><span style=display:flex><span>        index  index.html index.htm;
</span></span><span style=display:flex><span>   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=重载-nginx>重载 Nginx</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nginx -t
</span></span><span style=display:flex><span>nginx -s reload
</span></span></code></pre></div></p></section></article></article></div></div></div></main></div></body>