<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Https on 石の家</title><link>https://jemmycat.github.io/tags/https/</link><description>Recent content in Https on 石の家</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Tue, 22 Oct 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://jemmycat.github.io/tags/https/index.xml" rel="self" type="application/rss+xml"/><item><title>为网站配置免费的域名证书</title><link>https://jemmycat.github.io/posts/%E4%B8%BA%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AE%E5%85%8D%E8%B4%B9%E7%9A%84%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6/</link><pubDate>Tue, 22 Oct 2024 00:00:00 +0000</pubDate><guid>https://jemmycat.github.io/posts/%E4%B8%BA%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AE%E5%85%8D%E8%B4%B9%E7%9A%84%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6/</guid><description>&lt;p>&lt;img src="https://image.written.cc/i/2024/10/22/67171230ea128.png" alt="1729565225093.png">&lt;/p>
&lt;p>&lt;a href="https://acme.sh">acme.sh&lt;/a> 实现了ACME 协议，它不仅可以为您的域名从 Let&amp;rsquo;s Encrypt 生成免费的证书，而且通过配套的自动更新功能，能够为证书自动续期。&lt;/p>
&lt;blockquote>
&lt;p>基于 CentOS 7&lt;/p>
&lt;/blockquote>
&lt;h3 id="安装-acmesh">安装 acme.sh&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl &amp;lt;https://get.acme.sh&amp;gt; | sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="打开-godaddy">打开 Godaddy&lt;/h3>
&lt;ul>
&lt;li>打开Godaddy开发者平台&lt;/li>
&lt;li>打开API Keys&lt;/li>
&lt;li>Create New API Key（创建新的API Key）&lt;/li>
&lt;/ul>
&lt;h3 id="创建新的-api-key">创建新的 API Key&lt;/h3>
&lt;ul>
&lt;li>填写API Key的名称（可选）&lt;/li>
&lt;li>环境（Environment）选择产品（Production）&lt;/li>
&lt;/ul>
&lt;h3 id="保存生成的-key-和-secret">保存生成的 Key 和 Secret&lt;/h3>
&lt;h3 id="配置环境变量并生成证书">配置环境变量并生成证书&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>export GD_Key&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;gHzatahramcV_2f8geRg7UGanJiaKyied2F&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>export GD_Secret&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;RMuBD3tRiQ1D4YDkGewPGY&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --issue --dns dns_gd -d thongpunchangrc.com -d &lt;span style="color:#e6db74">&amp;#39;*.thongpunchangrc.com&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="安装nginx">安装nginx&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>yum install nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="将证书导出到-nginx-目录证书会被定期renew">将证书导出到 nginx 目录（证书会被定期renew）&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>mkdir /etc/nginx/cert
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --install-cert -d picokkplus.com -d *.picokkplus.com --key-file /etc/nginx/cert/key.pem --fullchain-file /etc/nginx/cert/cert.pem
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="配置nginx">配置nginx&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/nginx/conf.d/picokkplus.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>server &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen 80;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_name www.picokkplus.com picokkplus.com;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> rewrite ^/&lt;span style="color:#f92672">(&lt;/span>.*&lt;span style="color:#f92672">)&lt;/span> &amp;lt;http://www.picokkplus.com/$1&amp;gt; permanent;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> root /data/html/picokkplus;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> index index.html index.php;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>server &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> listen &lt;span style="color:#ae81ff">443&lt;/span> ssl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> server_name www.picokkplus.com picokkplus.com;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ssl_certificate /etc/nginx/cert/cert.pem;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#填写证书私钥文件绝对路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ssl_certificate_key /etc/nginx/cert/key.pem;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ssl_session_cache shared:SSL:1m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ssl_session_timeout 5m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#自定义设置使用的TLS协议的类型以及加密套件（以下为配置示例，请您自行评估是否需要配置）&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># TLS协议版本越高，HTTPS通信的安全性越高，但是相较于低版本TLS协议，高版本TLS协议对浏览器的兼容性较差。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#表示优先使用服务端加密套件。默认开启&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ssl_prefer_server_ciphers on;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#将所有HTTP请求通过rewrite指令重定向到HTTPS。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client_max_body_size 500m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> location / &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> root /data/html/picokkplus;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> index index.html index.htm;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="重载-nginx">重载 Nginx&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nginx -t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>nginx -s reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>